基于音乐平台的用户情感分析
 杨浩1，程波2
1.西南大学 计算机与信息科学学院，重庆400715
2.西南大学 计算机与信息科学学院，重庆400715
摘 要：为了实现音乐平台的个性化智能推荐服务以及用户心理评估，针对用户的听歌记录，获取歌词进行情感分析，判断出用户当前的情感状态，随后推送相应的歌曲或心理干预。音乐平台使用的是广受大学生青睐的网易云音乐，凭借用户的id获取用户的听歌记录，并爬取歌曲歌词，使用pyhton的jieba分词包进行分词。最后使用朴素贝叶斯进行歌曲情感分析。
关键词：情感分析；智能推送；词向量；if-tdf;


 
在如今的信息化、数字化和网络化时代，包含文本、图像、音频和视频的多媒体数据成为互联网上存储、传输和处理的数据的主要部分。据统计，音频、图像和视频等数据占据互联网数据比例已经达到15%，并且还将继续惊人增长，多媒体业务已经成为21世纪发展最快、规模最大的产业之一。正是由于多媒体技术的出现，计算机才能将人类的情感表现的更加丰富多彩。如今，利用计算机对多媒体数据的内容进行分析和处理已经成为多媒体领域的重要研究方向。
音频数据是多媒体数据的主要形式之一，也是组成多媒体数据的重要部分。它与人的感知因素的关联十分密切，其中包含有与内容相关的大量信息。音乐是多媒体音频数据中最重要的表达方式之一，而在如今的数字音乐时代，作为一种强大的分析工具的计算机已经被用来挖掘音乐深层次的信息，并且已经成为一种必然的趋势。国内外已经提出基于内容的检索CBR.。基于内容的音乐检索，正是以物理感知信息和语义信息作为检索方式，弥补了传统基于“作品属性”检索方式上的不足。在音乐内容的所有高级抽象形式中，人们能够毫不费力的理解语义信息，并将其应用与日常的情感表达和思想交流。因此，分析音乐的情感就是十分必要的，其重要性也不言而喻。
音乐情感分析的重要性重要体现在以下三个方面：一是情感识别等方面的人工智能研究可以借鉴音乐情感模型的研究思路，模式识别的其他领域也可以从该研究中获取一定的启发，从而推动自然化、智能化人机交互技术的快速发展；二是推动多媒体技术的快速持续发展，比如根据音乐内容表达的情感对音乐进行基于情感的检索，以及个性化智能推荐等。在情感分析已经成为多媒体数据分析的趋势的今天，这种情感化检索技术不仅可以应用与音乐，还可以扩展应用到动画、视频等其他相关多媒体研究领域中。三是音乐产业本身也可以从中受益并不断发展。音乐情感分析也可以促进利用计算机进行自动谱曲或音乐的自动改编技术的发展。
1 相关研究
近些年来，随着人工智能和模式识别等技术的飞速发展，人类希望机器能够像人一样可以理解人类的情感。长期以来，对情感进行研究都是从生理学和心理学的角度展开。而信息学、信号工学等工程学的角度来研究情感的时间却并不长。在音乐情感识别领域中，融合的层次主要在特征级融合和决策级融合。应用的数据来源主要有两种模态：歌词文本和音乐音频。以这两种作为数据源各有优缺点，以音频作为分析数据源，情感分类粒度较大，难以反映实际音乐情感的细腻的特点。以文本作为分析数据源，表示的情感更丰富，更接近人所体会到的音乐的情感，但难于将情感类别和声学参数联系。清华大学的Liu等28人提出情感识别系统。她将约翰斯特劳斯的华尔兹舞曲分成了五类情感，并利用模糊分类器对华尔兹舞曲进行着五类情感分类。台湾的陈若涵考虑了歌词的影响对古典音乐和流行音乐进行情感分类，并对GMM、SVM和KNNR等三类分类方法的分类效果作了比较。
     
2 本文的主要内容
	近年来，随着人工智能的发展，各种网页、app都开始做个性化的智能推荐。而音乐作为一种主要的多媒体资源，在人们的日常生活中就是息息相关的。我们几乎每天都会听音乐。因此，实现音乐的个性化智能推荐就显得尤为重要。传统的基于如歌曲的名称、演唱者或歌词的关键词等属性描述的音乐信息识别并
不能满足现代背景下人们对音乐检索的需要。情感是音乐的重要语义。也是音乐的最本质属性。以音乐情感作为推荐的依据，可以更好的满足用户的需求，实现个性化的精准推荐。
	本文从单模音乐情感分析出发，其主要内容：
1.	获取用户的听歌记录。本文的研究是以网易云音乐做为研究平台。网易云音乐会提供用户最近的听歌歌单。其中包含歌曲的歌名、歌手信息、听
的次数等等。通过用户的网易云id(此id不是用户名，而是一串数字)就可以获取相关信息。
2.	获取歌单中的歌曲歌词。根据用户的歌单信息可
以获取歌曲的id，根据这个id就可以爬取到歌曲
的歌词。
3.	歌曲歌词的分词处理。分词是使用python的jieba
分词库。Jieba分词库是一个功能强大的分词，支
   持中文，还包括其他诸如，词性、关键词提取等功能。
4. 对歌词的情感分析。使用台湾大学提供的情感词典
进行词向量提取，利用if-tdf进行特征融合。
 
				（图1 程序模块结构）


 
 
3 数据源的获取与处理
歌词是音乐歌曲中语音的书面表达部分，歌词不仅是文本，而且是蕴含了丰富情感的文本。从音乐的歌词文本中挖掘情感对音乐的情感分析是重要的侧面，具有重要的学术研究意义和价值。文本情感分析的目的就是提取文本所表达的情感并按照这些情感将文本分类。既然是文本，文本情感分类就保留有文本分类的特点，但同时具有自己的特性，因为文本情感分类着眼点和侧重点都是文本中包含的观点、褒贬情感等，而不是传统意义上文本分类的主题或者内容等属性。在计算机语言学中，按照处理文本的粒度不同，情感分析可分为词语级、短语级、句子级、篇章级以及多篇章级等多个研究层次。而对于歌曲的歌词文本而言，词语和句子所表达的情感都比较孤立，可能与歌词整体表达的情感不一致。因此歌词文本的情感分

3.1歌词获取
  爬取网易云音乐用户个人主页，根据爬取的网页，解析html文件结构，利用正则表达式进行匹配，得到用户最近一周收听歌曲的所有相关信息，比如歌曲的id、歌曲的歌名、歌曲的歌手，歌曲听的次数等。根据歌曲的id使用python的selenium工具进行爬取，使用此工具主要是为了防止网站的反爬虫机制。通过python的Beautifulsoup库进行html网页的解析，并将获取到的歌词保存为TXT格式的文档。
3.2歌词的处理
  爬取到的歌词文本还需要再进行进一步的分词处理。分词是使用python的jieba分词库，这个库支持精准中文分词，此处加入自定义分词词典，可以显著提高分词准确率。
3.3词向量
  经过分词后的歌词，使用台湾大学公布的情感词典（情感词在2万左右）生成词向量。
 
析需要的是篇章级的处理，即从整篇文档着眼整体判
断文本的情感。


 
 
 
4 情感分析模型建立
音乐情感是一个心理过程，它在人与音乐的交互过程中所产生，人类的各种感情因素均包含其中。要使用计算机进行音乐情感分析，首先要做的工作就是要根据人类对音乐的情感认知特点建立符合这种特点的心理模型，即符合情感认知规律的情感模型。虽然研究者们普遍认为要进行情感研究就必须进行一定的情感类型分类，但是如何有效的进行情感类型的划分却是一直到现在都还没有定论的问题。J.G.Taylor等通过面部表情的识别表明快乐、悲伤、中性、愤怒4种以基本情绪分类的表情在行为、唤醒和评价三维空间中各自成簇分布，尽管某些离散分布也存在，然而规律性分布的趋势并没有收到影响。具有代表性的情感模型：
Thayer情感模型
	Thayer模型是采用压力与能量两个维度来描述情感的二维维度空间分布。能量维度与认知活动的诸多方面及个体的生理活性是相联系的，它主要反应从“平静”到“充满活力”过程中不同活力度水平。压力维度主要反应的是主观的内部心理由快乐到焦虑这一连续体上不同水平的情感。Thayer情感模型连续性比较强，所以情感空间中各种不同情感间的过滤更加平滑。尽管如何，该模型仍旧有局限性，因为情感具有主观性，产生情感的主观因素也不是单一的，所以仅通过能量和压力两个维度并不能反映出人们的情感的丰富性。
Hevner情感模型
	Hevner情感模型在音乐与情感关系的研究中被研究者广泛认可并使用，是离散的情感模型。该情感模型将象征心境、情绪或情感反应的符号采用环形来表示，情感被划分为8个情感子类，情感逻辑上递进关系存在于任何前后相邻的不同环节之间，也就是表明左右相邻的不同情感之间在理性的情绪变化中可以平滑的过渡。
本文是基于音乐的情感分析，结合实际的应用，我们把情感分为4种即悲伤、励志、浪漫、欢快。
模型的训练
（1）	训练数据准备
因为是有监督学习，我们之前将文本的情感分为4种，分别是悲伤、励志、浪漫、欢快。因此准备的训练集包含四种分类用0、1、2、3进行标记，对应四种情感。训练集的来源是网易云音乐用户所建立的歌单,选择的歌单已经有自己的情感标识，且受到大量听众认可。训练集的建立应该避免不同歌单包含相同歌曲，且应注意训练集的数据不能与之后的测试数据有相同的歌曲
（2）	文本情感分类
模型的测试集为爬取的网易云音乐用户最近所收听歌曲的所有汉语歌词。
文本情感分类有两种加权方法，一种是词频加权，一种是TF-IDF策略，这里重点分析下tf-idf策略以及怎么通过训练集求出 ，即代码中 def calc_tfidf(self,trainset)，def cate_prob(self,classVec)函数的解析
首先了解下如下几个数据结构：
 
idf矩阵：n为情感词典词的总数，元素 表示情感词编号m在所有文本中出现的次数，注意：如果在一文本中情感词 m 出现了多次，也只算一次。接着将上面的idf数组转化为逆向文件频率。逆向文件频率是一个词语普遍重要性的度量。某一词语的idf,可以由总文件数目除以包含该词语的文件的数目，在将得到的商取对数得到。
 
其中，|D|:语料库中的文件总数。
J:包含词语的文件数目。如果该词语不在语料库中，就会导致分母为0，因此一般情况下使用1+{d∈D:ts∈d}作为分母。
Tf矩阵
 
其中，n表示情感词典词的总数，m表示所有文本个数，即创建了一个二维矩阵，矩阵元素amn表示在文本标号m中，出现标号为n的情感词的词频，接着再将tf消除不同句长导致的偏差。即将矩阵元素amn除以标号为m文本的所有单词数这样tf，idf数组向量求出后再相乘，就得到了TF-IDF权重，将权重再赋予tf矩阵。然后在计算if与tdf的乘积，某一特定文件内的高词语频率，以及该词语在整个文件集合中
的低文件频率，可以产生出高权重的tf-idf。因此，tf-idf倾向于过滤掉常见的词语，保留重要的词语。
Tdm矩阵
得到权重后，接下来就是求P(x|yi)，即统计得到在各类别下各个特征属性的条件概率的估计，即
 
首先，建立tdm矩阵，矩阵行为分类数，在本项目中，行数就为情感分类数，列为情感词典中情感词个数个数，而将tf中属于同一类的行相加，即得到tdm矩阵。
其次，建立sunlist矩阵，行数为分类数，列数为1，其元素是一标量，将tdm的属于同一类的行数元素累加，比如具体点的就是将tdm中是积极类的行数累加
那么tdm=tdm/sumlista就是p(x|yi)，即tdm最终保存的是在一分类中具有这些特征属性的概率。得到tdm矩阵后，就可以对测试文本进行分类了。
5 运行用例
模型运行：输入已经进行分词处理的文本，输出用户的情感状态。
 
6总结与展望
为期两个月的人工智能课程设计将要结束了。在这次项目实践中，我学到了很多，也找到了自己身上的不足。感受良多，获益匪浅。
	本项目的课题由我提出。拟题的初衷是考虑到现在社会生活节奏越来越快，随之而来的生活压力也越来越大。大学生更是面临学习，生活，就业的高压人群。研究表明，40%的大学生都曾有希望得到心理辅导的渴求。同时，大学生也是使用音乐平台的大基数人群。本项目将两者相结合，分析大学生收听的歌曲，评估心理状态，及时发现问题，并给予帮助。
　　完成课程设计期间，我们两人小组成员分工合作、齐心协力，一齐完成了课程设计前的准备工作（拟定课题，寻找数据源）、小组讨论分工、完成系统开发的各个文档、课程设计总结报告、小组汇报PPT、个人日记，个人小结的任务。在课程设计的第一天我们便对这次任务进行了规划和分工。在以后的几天中，我们组的成员一齐努力，查阅资料、小组讨论、对资料进行分析，并在这段时间里完成了所有模块的开发设计，并最后撰写课程设计报告及个人总结。我的主要工作是完成爬虫模块，分词模块，情感分析模块的代码编写，协助组员制作PPT，并上台汇报。
这次的课程设计对我们组两个人来说都是一个挑战。爬取数据不是难点，分词和情感分析对我们比较困难，平时对人工智能这方面的知识接触的就不是很多，而且对于贝叶斯原理的理解我就更抓狂了。这时候小组的力量就体现出来了，各司其职，各尽其能，最终成功完成项目。
本项目的展望是实现更高精确率的歌词情感分析，并向用户智能推荐歌曲。　
　　课程设计结束了，但我们一齐奋斗的精神和这份宝贵的经历将会成为人生道路上一道亮丽的风景线，在此，要感谢程波队友的倾力付出，感谢李莉老师的辛勤指导！
参考文献：
[1彭琼.音乐情感的计算机分析与自动识别研究[D]，上海交通大学学位论文 2010
[2]夏虎.情感化音乐评论分析及智能检索技术研究[D].电子科技大学学位论文 2007
[3] 朱春铃.论音乐与情感的关系，西南师范大学学报：人文社科版 2009
[4] 谢波.普通话语音情感识别关键技术研究[D].电子科技大学学位论文 2012
[5] 陈永彬.语音信号处理[M]，上海交通大学出版社,2008.
[6] 王治平等著.语音信号中的情感特征的分析和识别[A],第一届中国情感计算与智能交互学术会议（ACII’03）2015

